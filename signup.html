<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Create your account ‚Äî TypeFace Personal Finance</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/variable.css">
  <link rel="stylesheet" href="styles/global.css">
  <link rel="stylesheet" href="styles/component.css">
  <link rel="stylesheet" href="styles/login.css">

  <style>
    body.page[data-page="signup"]{
      background:
        radial-gradient(1000px 700px at 10% 5%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 700px at 100% 100%, rgba(36,209,126,.14), transparent 55%),
        var(--bg);
    }
    .auth{ width:min(1120px,95vw); margin: clamp(24px, 6vh, 48px) auto;
           display:grid; grid-template-columns:1.1fr 1fr; gap:clamp(18px,2.5vw,28px); }
    @media (max-width:950px){ .auth{grid-template-columns:1fr} .auth .right{display:none} }
    .left{
      display:grid; grid-template-rows:auto auto 1fr auto; gap:14px;
      border:1px solid rgba(255,255,255,.10); border-radius:16px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04)), var(--card);
      box-shadow:0 20px 60px rgba(0,0,0,.35); padding:18px; position:relative; overflow:hidden;
    }
    .brand{display:flex;align-items:flex-end;gap:12px}
    .title{font-size:clamp(22px,3vw,30px);letter-spacing:.2px;font-weight:800}
    .sub{color:var(--muted)}
    .form{display:grid;gap:14px}
    .field{position:relative; display:grid; gap:6px}
    .field__control{
      --h:48px; height:var(--h); width:100%; padding:14px 44px 0 14px; border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.10); color:var(--text); outline:none;
      transition: box-shadow .18s ease, border-color .18s ease, transform .06s ease;
    }
    .field__control:hover{ border-color: rgba(255,255,255,.18) }
    .field__control:focus{ box-shadow:0 0 0 4px var(--ring); border-color:transparent; }
    .field__label{
      position:absolute; left:14px; top:12px; color:var(--muted); font-size:.95rem; line-height:1;
      pointer-events:none; transform-origin:left top; transition: transform .16s ease, color .16s ease, opacity .16s ease; opacity:.9;
    }
    .field__control:not(:placeholder-shown)+.field__label,
    .field__control:focus+.field__label{ transform: translateY(-10px) scale(.84); color:#c9d3ea; opacity:.95; }
    .toggle{ position:absolute; right:6px; top:6px; height:36px; width:36px; display:grid; place-items:center;
             border-radius:10px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04); cursor:pointer; }
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .row .tip a{color:var(--text);text-decoration:underline}
    .meter{ height:8px; border-radius:999px; overflow:hidden; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.10); }
    .meter>span{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e); transition:width .25s ease; }
    .hint{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:.9rem}
    .right{
      border:1px solid rgba(255,255,255,.10); border-radius:16px;
      background: radial-gradient(520px 360px at 20% 10%, rgba(124,92,255,.14), transparent 60%),
                  radial-gradient(520px 360px at 100% 80%, rgba(36,209,126,.12), transparent 60%), var(--panel);
      position:relative; overflow:hidden; display:grid; place-items:center; padding:18px;
    }
    .brand-hero{width:min(560px, 88%); height:auto; object-fit:contain; filter: drop-shadow(0 24px 48px rgba(0,0,0,.35))}
    .brand-glow{position:absolute; inset:auto auto 12px 12px; font-weight:800; letter-spacing:.3px; font-size:14px; color:rgba(233,240,255,.75); text-shadow:0 0 24px rgba(124,92,255,.35)}
    /* reveal fail-safe (optional) */
    .reveal { opacity: 1 !important; transform: none !important; }
  </style>
  <link rel="icon" href="data:,">
</head>

<body class="page" data-page="signup">
  <main class="auth reveal">
    <section class="left" aria-labelledby="signup-title">
      <header class="brand">
        <div>
          <h1 id="signup-title" class="title">Create your account</h1>
          <p class="sub">Join TypeFace Personal Finance in seconds.</p>
        </div>
      </header>

      <form id="signupForm" class="form" novalidate>
        <div class="field">
          <input class="field__control" type="text" name="name" id="name" placeholder=" " autocomplete="name" required aria-required="true"/>
          <label class="field__label" for="name">Full name</label>
        </div>

        <div class="field">
          <input class="field__control" type="email" name="email" id="email" placeholder=" " autocomplete="email" required aria-required="true"/>
          <label class="field__label" for="email">Email</label>
        </div>

        <div class="field">
          <input class="field__control" type="password" name="password" id="pwd" placeholder=" " autocomplete="new-password" minlength="8" required aria-required="true"/>
          <label class="field__label" for="pwd">Password</label>
          <button type="button" id="togglePwd" class="toggle" aria-label="Toggle password visibility" title="Show/Hide password">üëÅÔ∏è</button>
        </div>

        <div class="meter" aria-hidden="true"><span id="pwdStrength"></span></div>
        <div class="hint" id="pwdHint">Use 8+ chars including upper, lower, number, and symbol.</div>

        <div class="field">
          <input class="field__control" type="password" name="confirm" id="pwd2" placeholder=" " autocomplete="new-password" minlength="8" required aria-required="true"/>
          <label class="field__label" for="pwd2">Confirm password</label>
          <button type="button" id="togglePwd2" class="toggle" aria-label="Toggle confirm password visibility" title="Show/Hide password">üëÅÔ∏è</button>
        </div>

        <div class="row">
          <label style="display:flex;align-items:center;gap:8px;color:var(--muted)">
            <input id="terms" type="checkbox" required style="accent-color:var(--primary)"/>
            I agree to the <a href="#" style="text-decoration:underline;color:var(--text)">Terms</a> & <a href="#" style="text-decoration:underline;color:var(--text)">Privacy</a>
          </label>
          <button class="btn" type="submit">Create account</button>
        </div>

        <small class="tip">Already have an account? <a href="index.html">Sign in</a></small>
      </form>
    </section>

    <aside class="right" aria-label="TypeFace brand">
      <picture>
        <source srcset="https://media.licdn.com/dms/image/v2/C4E0BAQF1toNGwK14PA/company-logo_200_200/company-logo_200_200/0/1677601239983/typefaceai_logo?e=2147483647&v=beta&t=GQ7ztKqQ_r5SdM2JMgaulMuvdVygIBG1Iaw37p3B5rE" type="image/webp"/>
        <img class="brand-hero" src="assets/typefaceai-brand.png" alt="TypeFaceAI brand artwork"/>
      </picture>
      <div class="brand-glow">TypeFace</div>
    </aside>
  </main>

  <!-- Base app (if needed by your site) -->
  <script type="module" src="scripts/app.js"></script>

  <!-- One unified script: validation + signup POST + redirect -->
  <script>
    (function(){
      const API_BASE = (window.VITE_API_BASE || "http://localhost:5001");

      const form  = document.getElementById('signupForm');
      const nameI = document.getElementById('name');
      const emailI= document.getElementById('email');
      const pwd   = document.getElementById('pwd');
      const pwd2  = document.getElementById('pwd2');
      const meter = document.getElementById('pwdStrength');
      const hint  = document.getElementById('pwdHint');
      const t1    = document.getElementById('togglePwd');
      const t2    = document.getElementById('togglePwd2');

      function scorePassword(v){
        let s=0; if(!v) return 0;
        if(/[a-z]/.test(v)) s++;
        if(/[A-Z]/.test(v)) s++;
        if(/[0-9]/.test(v)) s++;
        if(/[^A-Za-z0-9]/.test(v)) s++;
        if(v.length>=12) s++;
        if(/(.)\1{2,}/.test(v)) s = Math.max(0,s-1);
        return Math.max(0,Math.min(5,s));
      }
      function updateStrength(){
        const s = scorePassword(pwd.value||"");
        const pct=[0,20,40,60,80,100][s];
        meter.style.width = pct+'%';
        hint.textContent = s>=4 ? "Strong password ‚úî"
                         : s===3 ? "Good ‚Äî add one more character or symbol."
                         : s===2 ? "Fair ‚Äî use upper/lower and a number."
                         : "Too weak ‚Äî add length and variety.";
      }
      function updateMatch(){
        if(!pwd2.value){ pwd2.setCustomValidity(''); return; }
        pwd2.setCustomValidity(pwd.value===pwd2.value ? '' : 'Passwords do not match');
      }

      t1?.addEventListener('click', ()=>{ const isPwd=pwd.type==='password'; pwd.type=isPwd?'text':'password'; t1.textContent=isPwd?'üôà':'üëÅÔ∏è'; });
      t2?.addEventListener('click', ()=>{ const isPwd=pwd2.type==='password'; pwd2.type=isPwd?'text':'password'; t2.textContent=isPwd?'üôà':'üëÅÔ∏è'; });
      pwd.addEventListener('input', ()=>{ updateStrength(); updateMatch(); });
      pwd2.addEventListener('input', updateMatch);
      updateStrength();

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();        
        updateStrength(); updateMatch();
        if(!form.checkValidity()){ form.reportValidity(); return; }

        const payload = {
          name:  (nameI.value||'').trim(),
          email: (emailI.value||'').trim().toLowerCase(),
          password: pwd.value
        };
        const terms = document.getElementById('terms');
        if(terms && !terms.checked){ alert('Please accept Terms & Privacy'); return; }

        try{
          const res = await fetch(`${API_BASE}/api/auth/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',  
            body: JSON.stringify(payload)
          });
          const data = await res.json().catch(()=> ({}));
          if(!res.ok){ alert(data.error || 'Sign up failed'); return; }
          window.location.href = 'dashboard.html';
        }catch(err){
          console.error(err);
          alert('Network error ‚Äî please try again.');
        }
      });
    })();
  </script>
</body>
</html>
